(function($){var settings;var element;var map;var markers=new Array();var markerCluster;var clustersOnMap=new Array();var clusterListener;var methods={init:function(options){element=$(this);var defaults=$.extend({geolocation:!1,styles:null,zoom:14,markers:[],infowindow:{borderBottomSpacing:6,height:150,width:340,offsetX:-21,offsetY:-21},marker:{height:40,width:40},cluster:{height:40,width:40,gridSize:40}});settings=$.extend({},defaults,options);loadMap();if(options.callback){options.callback()}
return $(this)},removeMarkers:function(){for(i=0;i<markers.length;i++){markers[i].infobox.close();markers[i].marker.close();markers[i].setMap(null)}
markerCluster.clearMarkers();$.each(clustersOnMap,function(index,cluster){cluster.cluster.close()});clusterListener.remove()},addMarkers:function(options){markers=new Array();settings.locations=options.locations;settings.contents=options.contents;settings.types=options.types;renderElements()}}
$.fn.google_map=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments)}else{$.error('Method '+method+' does not exist on Aviators Map')}};function loadMap(){var mapOptions={zoom:settings.zoom,styles:settings.styles,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,draggable:!0,mapTypeControl:!1,panControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_BOTTOM}};if(settings.center!==undefined){mapOptions.center=new google.maps.LatLng(settings.center.latitude,settings.center.longitude)}
map=new google.maps.Map($(element)[0],mapOptions);if(settings.geolocation){if(navigator.geolocation){browserSupportFlag=!0;navigator.geolocation.getCurrentPosition(function(position){initialLocation=new google.maps.LatLng(position.coords.latitude,position.coords.longitude);map.setCenter(initialLocation)},function(){map.center=new google.maps.LatLng(settings.center.latitude,settings.center.longitude)})}else{browserSupportFlag=!1;map.center=new google.maps.LatLng(settings.center.latitude,settings.center.longitude)}}
if(settings.center===undefined){var bound=new google.maps.LatLngBounds();for(var i in settings.markers){bound.extend(new google.maps.LatLng(settings.markers[i].latitude,settings.markers[i].longitude))}
map.fitBounds(bound)}
google.maps.event.addListener(map,'zoom_changed',function(){$.each(markers,function(index,marker){if(marker.infobox!==undefined){marker.infobox.close();marker.infobox.isOpen=!1}})});renderElements()}
function isClusterOnMap(clustersOnMap,cluster){if(cluster===undefined){return!1}
if(clustersOnMap.length==0){return!1}
var val=!1;$.each(clustersOnMap,function(index,cluster_on_map){if(cluster_on_map.getCenter()==cluster.getCenter()){val=cluster_on_map}});return val}
function addClusterOnMap(cluster){$.each(cluster.getMarkers(),(function(){if(this.marker.isHidden==!1){this.marker.isHidden=!0;this.marker.close()}}));var newCluster=new InfoBox({markers:cluster.getMarkers(),draggable:!0,content:'<div class="clusterer"><div class="clusterer-inner">'+cluster.getMarkers().length+'</div></div>',disableAutoPan:!0,pixelOffset:new google.maps.Size(-21,-21),position:cluster.getCenter(),closeBoxURL:"",isHidden:!1,enableEventPropagation:!0,pane:"floatPane"});cluster.cluster=newCluster;cluster.markers=cluster.getMarkers();cluster.cluster.open(map,cluster.marker);clustersOnMap.push(cluster)}
function renderElements(){$.each(settings.markers,function(index,markerObject){var args={position:new google.maps.LatLng(markerObject.latitude,markerObject.longitude),map:map,};if(settings.transparentMarkerImage){args.icon={url:settings.transparentMarkerImage,size:new google.maps.Size(settings.marker.width,settings.marker.height)}}
var marker=new google.maps.Marker(args);if(markerObject.content){marker.infobox=new InfoBox({content:markerObject.content,disableAutoPan:!0,pixelOffset:new google.maps.Size(settings.infowindow.offsetX,settings.infowindow.offsetY,settings.infowindow.offsetX,settings.infowindow.offsetY),position:new google.maps.LatLng(markerObject.latitude,markerObject.longitude),isHidden:!1,closeBoxURL:"",pane:"floatPane",enableEventPropagation:!1});marker.infobox.isOpen=!1}
marker.marker=new InfoBox({draggable:!0,content:markerObject.marker_content,disableAutoPan:!0,pixelOffset:new google.maps.Size(-settings.marker.width/2,-settings.marker.height),position:new google.maps.LatLng(markerObject.latitude,markerObject.longitude),closeBoxURL:"",isHidden:!1,pane:"floatPane",enableEventPropagation:!0});marker.marker.isHidden=!1;marker.marker.open(map,marker);markers.push(marker);google.maps.event.addListener(marker,'click',function(e){if(marker.infobox!==undefined){var curMarker=this;$.each(markers,function(index,marker){if(marker!==curMarker){marker.infobox.close();marker.infobox.isOpen=!1}});if(curMarker.infobox){if(curMarker.infobox.isOpen===!1){curMarker.infobox.open(map,this);curMarker.infobox.isOpen=!0}else{curMarker.infobox.close();curMarker.infobox.isOpen=!1}}}})});markerCluster=new MarkerClusterer(map,markers,{gridSize:settings.cluster.gridSize,styles:[{textColor:'transparent',height:settings.cluster.height,url:settings.transparentClusterImage,width:settings.cluster.width}]});clustersOnMap=new Array();clusterListener=google.maps.event.addListener(markerCluster,'clusteringend',function(clusterer){var availableClusters=clusterer.getClusters();var activeClusters=new Array();$.each(availableClusters,function(index,cluster){if(cluster.getMarkers().length>1){activeClusters.push(cluster)}});$.each(availableClusters,function(index,cluster){if(cluster.getMarkers().length>1){var val=isClusterOnMap(clustersOnMap,cluster);if(val!==!1){val.cluster.setContent('<div class="clusterer"><div class="clusterer-inner">'+cluster.getMarkers().length+'</div></div>');val.markers=cluster.getMarkers();$.each(cluster.getMarkers(),(function(index,marker){if(marker.marker.isHidden==!1){marker.marker.isHidden=!0;marker.marker.close()}}))}else{addClusterOnMap(cluster)}}else{$.each(cluster.getMarkers(),function(index,marker){if(marker.marker.isHidden==!0){marker.marker.open(map,this);marker.marker.isHidden=!1}});$.each(clustersOnMap,function(index,cluster_on_map){if(cluster!==undefined&&cluster_on_map!==undefined){if(cluster_on_map.getCenter()==cluster.getCenter()){cluster_on_map.cluster.close();clustersOnMap.splice(index,1)}}})}});var newClustersOnMap=new Array();$.each(clustersOnMap,function(index,clusterOnMap){var remove=!0;$.each(availableClusters,function(index2,availableCluster){if(availableCluster.getCenter()==clusterOnMap.getCenter()){remove=!1}});if(!remove){newClustersOnMap.push(clusterOnMap)}else{clusterOnMap.cluster.close()}});clustersOnMap=newClustersOnMap});$(document).on('click','.infobox .close',function(e){e.preventDefault();$.each(markers,function(index,marker){marker.infobox.isHidden=!0;marker.infobox.close()})})}})(jQuery)